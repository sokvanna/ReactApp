<!DOCTYPE html>
<html>

<head>
	<title>SamePage</title>
	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="styles.css" media="all" type="text/css" rel="stylesheet">
  <script src="https://fb.me/react-0.13.3.min.js"></script>
  <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
</head>

<body>
<div id="header">

</div>

<div id="main">

</div>

<div id="footer">

</div>
<script type="text/jsx">

$(document).ready(function(){
 
  getBooks();


function getBooks(){

  var BookTitle = [];

  $.ajax({
    url: 'https://en.wikipedia.org/w/api.php?action=query&list=random&format=json&rnnamespace=108&rnlimit=10',
    data: {
        format: 'json'
    },
    dataType: 'jsonp'
}).done( function ( data ) {
  for(var i = 0; i < data.query.random.length; i++){
   console.log(data.query.random[i]);

   var title = data.query.random[i].title.replace('Book:', '');
   var ID = data.query.random[i].id;

   BookTitle.push(title );

   if(i == data.query.random.length - 1){
    startReact(BookTitle);
   }
  
}

} );


}

function startReact(BookTitle){


var Library = React.createClass({
  handleClick: function(i) {
    
    

    var getTitle =  this.props.items[i];
console.log(getTitle);
var infoUrl = 'https://en.wikipedia.org/w/api.php?action=query&prop=categories|pageimages|pageterms&format=json&rawcontinue=&titles=Book:' + getTitle;
var imageUrl = 'https://en.wikipedia.org//w/api.php?action=query&titles=' +getTitle+ '&prop=pageimages';
// get category and description if available
 var setThis = $(this.getDOMNode()).find('div:contains(' + getTitle + ')');
    console.log(setThis);
 var splitClass = setThis.attr('class').split(' ');
 var alreadyDid = splitClass[1];
 setThis.append('<div class="bookInfo"></div>');
// get image url
$.ajax({
    url: imageUrl,
    data: {
        format: 'json'
    },
    dataType: 'jsonp'
}).done( function ( data ) {
  var firsty;
  
for (first in data.query.pages) {
firsty = first;
}
if(typeof alreadyDid == 'undefined'){
setThis.find('.bookInfo').append('<img src="'+data.query.pages[firsty].thumbnail.source+'"/>');
setThis.addClass('appendSet');
} 

console.log(data.query.pages[firsty].thumbnail.source);

} );

$.ajax({
    url: infoUrl,
    data: {
        format: 'json'
    },
    dataType: 'jsonp'
}).done( function (data) {

    var firsty;
  
for (first in data.query.pages) {
firsty = first;
}
for (allCats in data.query.pages[firsty].categories) {
checkCats = allCats;
console.log(data.query.pages[firsty].categories[checkCats].title);
if(typeof alreadyDid == 'undefined'){
  console.log(setThis.parent());
setThis.find('.bookInfo').append('<p>"'+data.query.pages[firsty].categories[checkCats].title+'"</p>');
setThis.addClass('appendSet');

}

}

setThis.find('.bookInfo').slideToggle();



} );


  
  },

  render: function() {
    return (
      <div>
        {this.props.items.map(function(item, i) {
          return (
            <div className="bookTitle" onClick={this.handleClick.bind(this, i)} key={i}>{item}</div>
          );
        }, this)}
      </div>
    );
  }
});

React.render(
  <Library items={BookTitle} />, document.getElementById('main')
);

}


});

</script>
</body>


</html>